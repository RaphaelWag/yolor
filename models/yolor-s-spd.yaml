# parameters
nc: 10  # number of classes
depth_multiple: 0.33  # model depth multiple
width_multiple: 0.50  # layer channel multiple

# anchors
anchors:
  - [ 12,16, 19,36, 40,28 ]  # P3/8
  - [ 36,75, 76,55, 72,146 ]  # P4/16
  - [ 142,110, 192,243, 459,401 ]  # P5/32

# yolov4s backbone
backbone:
  # [from, number, module, args]
  [ [ -1, 1, Conv, [ 32, 3, 1 ] ],  # 0       # 0
    [ -1, 1, Conv, [ 64, 3, 1 ] ],  # 1-P1/2  # 1
    [ -1, 1, space_to_depth, [ 1 ] ],         # 2
    [ -1, 1, Bottleneck, [ 64 ] ],            # 3
    [ -1, 1, Conv, [ 128, 3, 1 ] ],  # 3-P2/4 # 4
    [ -1, 1, space_to_depth, [ 1 ] ],         # 5
    [ -1, 2, BottleneckCSP, [ 128 ] ],        # 6
    [ -1, 1, Conv, [ 256, 3, 1 ] ],  # 5-P3/8 # 7
    [ -1, 1, space_to_depth, [ 1 ] ],         # 8
    [ -1, 8, BottleneckCSP, [ 256 ] ],        # 9
    [ -1, 1, Conv, [ 512, 3, 1 ] ],  # 7-P4/16 # 10
    [ -1, 1, space_to_depth, [ 1 ] ],         # 11
    [ -1, 8, BottleneckCSP, [ 512 ] ],        # 12
    [ -1, 1, Conv, [ 1024, 3, 1 ] ], # 9-P5/32 # 13
    [ -1, 1, space_to_depth, [ 1 ] ],           # 14
    [ -1, 4, BottleneckCSP, [ 1024 ] ],  # 10   #15
  ]

# yolov4s head
# na = len(anchors[0])
head:
  [ [ -1, 1, SPPCSP, [ 512 ] ], # 11  #16
    [ -1, 1, Conv, [ 256, 1, 1 ] ], #17
    [ -1, 1, nn.Upsample, [ None, 2, 'nearest' ] ], # 18
    [ 12, 1, Conv, [ 256, 1, 1 ] ], # route backbone P4 # 19
    [ [ -1, -2 ], 1, Concat, [ 1 ] ],             # 20
    [ -1, 2, BottleneckCSP2, [ 256 ] ], # 16      # 21
    [ -1, 1, Conv, [ 128, 1, 1 ] ],               # 22
    [ -1, 1, nn.Upsample, [ None, 2, 'nearest' ] ], # 23
    [ 9, 1, Conv, [ 128, 1, 1 ] ], # route backbone P3 #24
    [ [ -1, -2 ], 1, Concat, [ 1 ] ],           # 25
    [ -1, 2, BottleneckCSP2, [ 128 ] ], # 21    # 26
    [ -1, 1, Conv, [ 256, 3, 1 ] ], # 22        # 27
    [ -2, 1, Conv, [ 256, 3, 1 ] ],             # 28
    [ -1, 1, space_to_depth, [ 1 ] ],           # 29
    [ [ -1, 21 ], 1, Concat, [ 1 ] ],  # cat    # 30
    [ -1, 2, BottleneckCSP2, [ 256 ] ], # 25    # 31
    [ -1, 1, Conv, [ 512, 3, 1 ] ], # 26        # 32
    [ -2, 1, Conv, [ 512, 3, 1 ] ],             # 33
    [ -1, 1, space_to_depth, [ 1 ] ],           # 34
    [ [ -1, 16 ], 1, Concat, [ 1 ] ],  # cat     # 35
    [ -1, 2, BottleneckCSP2, [ 512 ] ], # 28     # 36
    [ -1, 1, Conv, [ 1024, 3, 1 ] ], # 30        # 37

    [ [ 27,32,37 ], 1, IDetect, [ nc, anchors ] ],   # Detect(P3, P4, P5)
  ]